<!DOCTYPE html>
<meta charset="UTF-8">
<title>ç¥å¥‡æµ·èº - ä¸ºä»€ä¹ˆä¸é—®é—®ç¥å¥‡æµ·èºå‘¢ï¼Ÿ</title>

<meta name="viewport" content="width=device-width,user-scalable=no">
<style>
body,h1,form{
	margin:0;
}
html{
	font:1em "BlinkMacSystemFont","Microsoft YaHei","å¾®è½¯é›…é»‘","WenQuanYi Micro Hei",sans-serif;
	text-align:center;
}
input{
	font:inherit;
}
input:focus{
	outline:none;
}
::selection{
	background:rgba(0,149,255,0.1);
}
a{
	text-decoration:none;
	color:#58a4dd;
}
h1{
	font-size:3.5em;
	padding:1.5em 0;
	color:#0bb1f5;
	font-weight:200;
}
h1:before{
	content:'ğŸš ';
}
#è¾“å…¥æ¡† input{
	ime-mode:inactive;
	ime-mode:disabled;

	border:none;
	
	font-size:1.4em;
	padding:.5em .7em;
	max-width:30em;
	width:100%;
	background:#F8F8F8;
	
	box-shadow:
		0 0 0 1px #DDD inset,
		0 1px 2px rgba(0,0,0,.2);
	
	transition: box-shadow .3s ease;

	border-radius:4px;

	text-align:center;
	-webkit-appearance:none;

}
#è¾“å…¥æ¡† input:focus{
	box-shadow:
		0 0 0 2px #58a4dd inset,
		0 3px 3px rgba(0,0,0,.2) inset;
}
#ç»“æœ{
	padding:2em 0;
}
#ç»“æœ a{
	display:block;
	padding:.5em;
	font-size:1.4em;
}
#ç»“æœ a:hover{
	background:rgba(88,164,221,.1);
}
.text-banner{
	font-size:1.4em;
	line-height:4em;
	color:#DDD;
}
footer{
	font-size:1.4em;
	line-height:6em;
	color:#DDD;
}

@media (max-width:600px) {
	h1{
		padding:.5em 0;
	}
	h1:before{
		display:none;
	}
	#è¾“å…¥æ¡†{
		padding:0 1em;
	}
}
</style>


<h1>ç¥å¥‡æµ·èº</h1>
<form id="è¾“å…¥æ¡†" autocomplete="off">
	<input type="search" name="text" placeholder="é”®å…¥å…³é”®å­—ã€å›è½¦ç›´è¾¾">
</form>
<div id="ç»“æœ"></div>

<footer>
	ä¸ºä»€ä¹ˆä¸é—®é—®ç¥å¥‡æµ·èºå‘¢ï¼Ÿ
</footer>


<script>
// https://github.com/jordanthomas/jaro-winkler/
(function (root) {
  'use strict';

  function extend(a, b) {
    for (var property in b) {
      if (b.hasOwnProperty(property)) {
        a[property] = b[property];
      }
    }

    return a;
  }

  function distance(s1, s2, options) {
    var m = 0;
    var defaults = { caseSensitive: true };
    var settings = extend(defaults, options);
    var i;
    var j;

    // Exit early if either are empty.
    if (s1.length === 0 || s2.length === 0) {
      return 0;
    }

    // Convert to upper if case-sensitive is false.
    if (!settings.caseSensitive) {
      s1 = s1.toUpperCase();
      s2 = s2.toUpperCase();
    }

    // Exit early if they're an exact match.
    if (s1 === s2) {
      return 1;
    }

    var range = (Math.floor(Math.max(s1.length, s2.length) / 2)) - 1;
    var s1Matches = new Array(s1.length);
    var s2Matches = new Array(s2.length);

    for (i = 0; i < s1.length; i++) {
      var low  = (i >= range) ? i - range : 0;
      var high = (i + range <= (s2.length - 1)) ? (i + range) : (s2.length - 1);

      for (j = low; j <= high; j++) {
        if (s1Matches[i] !== true && s2Matches[j] !== true && s1[i] === s2[j]) {
          ++m;
          s1Matches[i] = s2Matches[j] = true;
          break;
        }
      }
    }

    // Exit early if no matches were found.
    if (m === 0) {
      return 0;
    }

    // Count the transpositions.
    var k = 0;
    var numTrans = 0;

    for (i = 0; i < s1.length; i++) {
      if (s1Matches[i] === true) {
        for (j = k; j < s2.length; j++) {
          if (s2Matches[j] === true) {
            k = j + 1;
            break;
          }
        }

        if (s1[i] !== s2[j]) {
          ++numTrans;
        }
      }
    }

    var weight = (m / s1.length + m / s2.length + (m - (numTrans / 2)) / m) / 3;
    var l = 0;
    var p = 0.1;

    if (weight > 0.7) {
      while (s1[l] === s2[l] && l < 4) {
        ++l;
      }

      weight = weight + l * p * (1 - weight);
    }

    return weight;
  }

  if (typeof define === 'function' && define.amd) {
    define([], function() {return distance});
  } else if (typeof exports === 'object') {
    module.exports = distance;
  } else {
    root.distance = distance;
  }
})(this);
</script>


<script>

var 
sites={};


var 
x=new XMLHttpRequest();

x.open('GET','sites.json',1);

x.onload=function(r){
	r=JSON.parse(x.response);

	for(var domain in r){

		r[domain].domain=r[domain].href.
			replace(/^https?:\/\//,'').
			replace(/^www\./,'').
			replace(/\/.*$/,'');

		sites[domain+' '+r[domain].title]=r[domain];
	}
}

x.send();


var 
åˆ¤æ–­é‡å¤=function(arr,o){
	for(var i=0,l=arr.length;i<l;i++){
		if(arr[i].domain==o.domain){
			return true;
		}
	}

	return false;
},
æœ€è¿‘è¾“å…¥ç»“æœ=[],
å†å²è·³è½¬ç»“æœæ•°é‡=5,
å±•ç¤ºæœ€è¿‘è¾“å…¥çš„å…³é”®å­—=function(){
	ç»“æœ.innerHTML=åˆ—è¡¨è½¬æ¢(æœ€è¿‘è¾“å…¥ç»“æœ);
},
åˆ—è¡¨è½¬æ¢=function(r){
	return r.map(function(o){
		return '<a href="'+(o.href.match(/^http/)?'':'http://')+o.href+'">'+o.domain+' - '+o.title+'</a>';
	}).join('');
},
æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨=[],
æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨æœ€å¤§æ•°é‡é™åˆ¶=30,
æ ¹æ®å…³é”®å­—æœç´¢å¹¶å±•ç¤º=function(text){

	var 
	ä¸­æ–‡æ¨¡å¼=!!text.match(/[ä¸€-é¾¥]/);

	// console.log(sites);

	æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨=[];

	for(var domain in sites){
		// if(domain.search(text)!=-1){
			sites[domain].é¡ºåº=distance(ä¸­æ–‡æ¨¡å¼?sites[domain].title:domain,text);//+distance(sites[domain].title,text);
			æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨.push(sites[domain]);
		// }
	}

	æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨.sort(function(a,b){
		return b.é¡ºåº-a.é¡ºåº;
	});


	if(æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨.length>æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨æœ€å¤§æ•°é‡é™åˆ¶)
		æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨.length=æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨æœ€å¤§æ•°é‡é™åˆ¶;

	ç»“æœ.innerHTML=åˆ—è¡¨è½¬æ¢(æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨);
};

è¾“å…¥æ¡†.onsubmit=function(e){
	if(e)
		e.preventDefault();

	var 
	text=è¾“å…¥æ¡†.text.value.trim();
	text=text.toLowerCase();



	if(text.match(/^https?:/)){
		location.href=text;
		return;
	}

	if(!text.match(/:/) && text.match(/^(www|blog|bbs)|\.(com|net|org)$/)){
		location.href='http://'+text;
		//location.href='https://www.google.com/search?safe=strict&site=&source=hp&q='+encodeURIComponent(text)+'&btnI=%C2%A0æ‰‹æ°”ä¸é”™%C2%A0';
		return;
	}


	æ ¹æ®å…³é”®å­—æœç´¢å¹¶å±•ç¤º(text);

	var 
	a=ç»“æœ.querySelector('a');
	if(a){



		if(æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨[0] && !åˆ¤æ–­é‡å¤(æœ€è¿‘è¾“å…¥ç»“æœ,æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨[0])){




			æœ€è¿‘è¾“å…¥ç»“æœ.unshift(æœ€ç»ˆå±•ç¤ºåœ°å€åˆ—è¡¨[0]);

			if(æœ€è¿‘è¾“å…¥ç»“æœ.length>å†å²è·³è½¬ç»“æœæ•°é‡){
				æœ€è¿‘è¾“å…¥ç»“æœ.length=å†å²è·³è½¬ç»“æœæ•°é‡;
			}

			if(window.localStorage){
				localStorage.å†å²æœç´¢=JSON.stringify(æœ€è¿‘è¾“å…¥ç»“æœ);
			}
		}
		

		location.href=a.href;
	}
};




try{
	æœ€è¿‘è¾“å…¥ç»“æœ=JSON.parse(localStorage.å†å²æœç´¢);
}catch(e){
	æœ€è¿‘è¾“å…¥ç»“æœ=[];
}



å±•ç¤ºæœ€è¿‘è¾“å…¥çš„å…³é”®å­—();

è¾“å…¥æ¡†.text.oninput=function(){
	var 
	text=è¾“å…¥æ¡†.text.value.trim();//.match(/^\w+$/);
	text=text.toLowerCase();


	clearTimeout(ç»“æœ.T);


	if(!text){
		å±•ç¤ºæœ€è¿‘è¾“å…¥çš„å…³é”®å­—();
		return;
	}



	ç»“æœ.T=setTimeout(function(){


		æ ¹æ®å…³é”®å­—æœç´¢å¹¶å±•ç¤º(text);
	},20);

}

è¾“å…¥æ¡†.text.focus();


document.body.onclick=function(e){
	var 
	target=e.target,
	action=target.getAttribute('action');


	switch(action){
		case 'æœç´¢':

			var 
			text=target.innerHTML;

			è¾“å…¥æ¡†.text.focus();
			è¾“å…¥æ¡†.text.value=text;
			è¾“å…¥æ¡†.text.oninput();
			break;
	}
}


console.log('ç¥å¥‡æµ·èº https://github.com/itorr/magiconch.com');
console.log('ç½‘å€æäº¤ https://github.com/itorr/magiconch.com/issues/1');

</script>